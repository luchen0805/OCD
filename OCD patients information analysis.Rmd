---
title             : "OCD Patients Information Analysis"

author: 
  - name          : "Luchen Yu"
    affiliation   : "1"
    email         : "ylc23@uchicago.edu"

affiliation:
  - id            : "1"
    institution   : "University of Chicago"

authornote: |
  Add complete departmental affiliations for each author here. Each new line herein must be indented, like this line.

  Enter author note here.

abstract: |
  One or two sentences providing a **basic introduction** to the field,  comprehensible to a scientist in any discipline.
  Two to three sentences of **more detailed background**, comprehensible  to scientists in related disciplines.
  One sentence clearly stating the **general problem** being addressed by  this particular study.
  One sentence summarizing the main result (with the words "**here we show**" or their equivalent).
  Two or three sentences explaining what the **main result** reveals in direct comparison to what was thought to be the case previously, or how the  main result adds to previous knowledge.
  One or two sentences to put the results into a more **general context**.
  Two or three sentences to provide a **broader perspective**, readily comprehensible to a scientist in any discipline.
  
  <!-- https://tinyurl.com/ybremelq -->
  
keywords          : "keywords"
wordcount         : "X"

bibliography      : "r-references.bib"

floatsintext      : no
linenumbers       : yes
draft             : no
mask              : no

figurelist        : no
tablelist         : no
footnotelist      : no

classoption       : "man"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
library("papaja")
r_refs("r-references.bib")
```

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```

```{r data-prep}
# load readr package
library(readr)

# read in the dataset
data <- read.csv("ocd_patient_dataset.csv")

# examine the dataset
str(data)

# It includes many variable columns that I don't need, and I don't want Patient.ID to represent patients, I want ordered patient numbers

# select specific variable columns that are related to my research questions
library(dplyr)
data <- select(data, Patient.ID, Education.Level, Family.History.of.OCD, Previous.Diagnoses, Y.BOCS.Score..Obsessions., Y.BOCS.Score..Compulsions., Anxiety.Diagnosis, Depression.Diagnosis)

# Now I have only these three variable columns that I need for the project with patient ID column
# For a more clear looking dataset, I want to replace these non-ordered patient ID with integers 1-1500
# I will remove Patient.ID column and create Patient.Number column as the first variable column

# create a new patient id column with ordered integers from 1 to 1500
new_patients_id <- 1:1500
data$Patient.ID <- new_patients_id

# export this new dataset
csv_file_path <- "final_data_prep.csv"
write.csv(data, csv_file_path)

# Now it's a concise dataset with every variable I need and ordered with patient numbers
# And I think it's good now for the next data analysis part

# each column is either a character or numeric number
# each row is a single observation for one patient
# each cell is a single measurement
# for research questions about the association of the prevalence of OCD with education level, family history of OCD, and previously diagnosed disorders, only the column "Education Level", "Family History of OCD", and "Previous Diagnoses" are needed, all the other columns are extraneous
```

```{r anxiety-diagnosis-plot, fig.cap="Predict anxiety disorder through education level and family history of OCD"}
library(ggplot2)

data %>%
  mutate(Education.Level = factor(Education.Level, levels = c("High School", "Some College", "College Degree", "Graduate Degree"))) %>%
  ggplot(aes(x = Education.Level, fill = Anxiety.Diagnosis)) +
  geom_bar(position = "fill") +
  facet_grid(Family.History.of.OCD ~ .) +
  labs(title = "Anxiety Diagnosis by Education Level and Family History of OCD",
       subtitle = "A prediction for anxiety disorder",
       x = "Education Level",
       y = "Proportion",
       fill = "Anxiety Diagnosis",
       caption = "Predict anxiety disorder through education Level and family history of OCD"
  ) +
  scale_fill_manual(values = c("Yes" = "purple", "No" = "blue")) +
  theme_minimal() +
  theme(axis.text = element_text(size = 8), # decrease the font size for axis labels
        axis.title.x = element_text(margin = margin(t = 10)), # increase the space between x-axis label and name
        axis.title.y = element_text(margin = margin(r = 10)), # increase the space between y-axis label and name
        plot.caption = element_text(hjust = 1, size = 5),
        plot.subtitle = element_text(hjust = 0.5), # in the middle
        plot.title = element_text(hjust = 0.5),
        legend.title = element_text(size = 10),
        legend.text = element_text(size = 10))
```


```{r descriptive-analysis-anxiety-diagnosis-plot}
# calculate proportions for the facet where Family.History.of.OCD == "Yes"
proportions <- data %>%
  mutate(Education.Level = factor(Education.Level, levels = c("High School", "Some College", "College Degree", "Graduate Degree"))) %>%
  filter(Family.History.of.OCD == "Yes") %>%
  group_by(Education.Level, Anxiety.Diagnosis) %>%
  summarize(Count = n()) %>%
  group_by(Education.Level) %>%
  mutate(Proportion = Count / sum(Count))
proportions

# calculate proportions for the facet where Family.History.of.OCD == "No"
proportions2 <- data %>%
  mutate(Education.Level = factor(Education.Level, levels = c("High School", "Some College", "College Degree", "Graduate Degree"))) %>%
  filter(Family.History.of.OCD == "No") %>%
  group_by(Education.Level, Anxiety.Diagnosis) %>%
  summarize(Count2 = n()) %>%
  group_by(Education.Level) %>%
  mutate(Proportion2 = Count2 / sum(Count2))
proportions2
```

Among individuals with a family history of OCD: 
For the education level of high school, there were 97 cases where anxiety disorder was not diagnosed, constituting approximately 55.7% of the total cases. Meanwhile, there were 77 cases where anxiety disorder was diagnosed, accounting for around 44.3% of the total cases.
For individuals with some college education, there were 99 cases where anxiety disorder was not diagnosed, making up about 51.3% of the total cases. Additionally, there were 94 cases where anxiety disorder was diagnosed, representing approximately 48.7% of the total cases.
Among individuals with a college degree, there were 97 cases where anxiety disorder was not diagnosed, accounting for approximately 51.9% of the total cases. Conversely, there were 90 cases where anxiety disorder was diagnosed, accounting for approximately 48.1% of the total cases.
For individuals with a graduate degree, there were 91 cases where anxiety disorder was not diagnosed, representing around 44.2% of the total cases. On the other hand, there were 115 cases where anxiety disorder was diagnosed, making up about 55.8% of the total cases.
In order to make it easier to look at these data, make a summary table for these proportions.


```{r proportions-summary-table-one-anxiety-diagnosis-plot, caption="Proportion summary table one"}
# with a family history of OCD
apa_table(proportions,
          caption = "Proportions of Anxiety Diagnosis by Education Level and Family History of OCD",
          note = "Under the situation of having a family history of OCD",
          align = c("l", "c", "c", "c"),  # Align columns
          row.names = FALSE,  # Exclude row names
          table.number = 1)

```



```{r proportions-summary-table-two-anxiety-diagnosis-plot, caption="Proportion summary table two"}
# does not have a family history of OCD
apa_table(proportions2,
          caption = "Proportions of Anxiety Diagnosis by Education Level and Family History of OCD",
          note = "Under the situation of not having a family history of OCD",
          align = c("l", "c", "c", "c"),
          row.names = FALSE,
          table.number = 2)
```



According to the proportion values in Table\ \@ref(tab:proportions-summary-table-one-anxiety-diagnosis-plot), it is hard to make a conclusion about whether education level can predict the occurrence of anxiety disorder or family history of OCD can predict the occurrence of anxiety disorder. 


```{r test-analysis-anxiety-diagnosis-plot}
# recode Anxiety.Diagnosis to binary (0 and 1)
data$Anxiety.Diagnosis <- ifelse(data$Anxiety.Diagnosis == "Yes", 1, 0)

# convert 'Education.Level' to a factor with specified levels
data2 <- data %>%
  mutate(Education.Level = factor(Education.Level, levels = c("High School", "Some College", "College Degree", "Graduate Degree")))

# fit logistic regression model
logistic_model <- glm(Anxiety.Diagnosis ~ Education.Level + Family.History.of.OCD, data = data2, family = "binomial") 
# anxiety is classified into yes or no, it fits the binary outcome, so it follows the binomial distribution

# summarize the logistic regression model
summary(logistic_model)
```


```{r analysis-result-anxiety-diagnosis-plot}
# Coefficient Significance: p-values associated with each coefficient estimate. Lower p-values indicate higher significance. Significance level is denoted by asterisk. In this case, the coefficient for "Education.Level Graduate Degree" is significant at the 0.05 level. It has a significant p-value (p = 0.0322), suggesting that it is a significant predictor of 'Anxiety.Diagnosis' compared to other education levels.

# Effect Size: the magnitude of the coefficients. Larger coefficients indicate a stronger effect on the outcome variable. In this case, the coefficient for 'Education.Level Graduate Degree' (0.31656) is relatively large compared to other coefficients, so it has a stronger effect on 'Anxiety.Diagnosis' than other education levels.

# 'Education.Level Some College', 'Education.Level College Degree', and 'Family.History.of.OCD' are not statistically significant predictors of 'Anxiety.Diagnosis', as their coefficients have p-values greater than 0.05.

# Model Fit: AIC evaluates the overall fit of the model. Lower AIC value indicates better model fit. In this case, it has the value of 2082.4.
```



```{r score-plot, fig.cap="Y-BOCS score and education levels"}
# reshape data into long format, gather the variables "Y-BOCS Score Obsessions" and "Y-BOCS Score Compulsions" into one single column named "Score_Value", and a new column named "Score_Type" is created to indicate the type of score.
library(tidyr)

# convert data into long format
data_long <- data %>%
  pivot_longer(cols = c(Y.BOCS.Score..Obsessions., Y.BOCS.Score..Compulsions.), names_to = "Score_Type", values_to = "Score_Value")

# Create boxplots
data_long %>%
  mutate(Education.Level = factor(Education.Level, levels = c("High School", "Some College", "College Degree", "Graduate Degree"))) %>%
  ggplot(aes(x = Education.Level, y = Score_Value, fill = Education.Level)) +
  geom_boxplot() +
  facet_wrap(~ Score_Type, scales = "free_y", labeller = labeller(Score_Type = c("Y.BOCS.Score..Compulsions." = "Y-BOCS Score Compulsions", "Y.BOCS.Score..Obsessions." = "Y-BOCS Score Obsessions"))) +
  labs(
    x = "Education Level",
    y = "Y-BOCS Score",
    title = "Y-BOCS Scores for Different Education Levels",
    subtitle = "Subdivided into obsession score and compulsion score",
    caption = "Y-BOCS score and education levels"
  ) +
  theme_apa() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
        axis.text = element_text(size = 10),
        strip.text = element_text(size = 6),
        plot.caption = element_text(hjust = 1, size = 5))

```




```{r descriptive-analysis-score-plot}
# Calculate summary statistics for each Score_Type and Education Level
summary_stats <- data_long %>%
  mutate(Education.Level = factor(Education.Level, levels = c("High School", "Some College", "College Degree", "Graduate Degree"))) %>%
  group_by(Score_Type, Education.Level) %>%
  summarize(
    mean_score = mean(Score_Value),
    median_score = median(Score_Value),
    min_score = min(Score_Value),
    max_score = max(Score_Value),
    sd_score = sd(Score_Value),
    .groups = "drop"  # Override grouped output
  )
summary_stats


# Mean Score by Education Level: From the table, the mean Y.BOCS.Score varies slightly across different education levels within each Score_Type (Obsessions and Compulsions). The mean score for Compulsions ranges from 18.5 to 20.2, while for Obsessions, it ranges from 19.5 to 20.6. This suggests that there might be some differences in symptom severity based on education level, although the differences are relatively small.

# Median Score by Education Level: Similarly, the median score provides an indication of the central tendency of the data. The median Y.BOCS.Score varies slightly across different education levels within each Score_Type (Obsessions and Compulsions).

# Standard Deviation: The standard deviation (sd_score) measures the variability/spread of the Y.BOCS.Score within each group. Higher standard deviations indicate greater variability in scores. From the table, it is observed that the standard deviations are relatively consistent across different education levels within each Score_Type, ranging from approximately 11.6 to 11.9. This suggests that the spread of Y.BOCS.Score does not vary significantly across education levels.

# Minimum and Maximum Scores: The minimum and maximum scores provide insights into the range of Y.BOCS.Score within each group. In this case, it is observed that the minimum score is 0 and the maximum score is 40 for all education levels within each Score_Type. This indicates that the full range of scores is observed across all education levels, and there are no outliers beyond this range.

# Overall, while there are slight variations in mean and median scores across education levels within each Score_Type, the differences are relatively small. Additionally, the variability in Y.BOCS.Score does not appear to vary significantly across education levels. Further statistical analysis, such as ANOVA, could be conducted to formally assess whether there are statistically significant differences in Y.BOCS.Score across education levels within each Score_Type.
```


in-text reference: score 'r summary_stats$mean_score[1]'


```{r test-analysis-score-plot}
# ANOVA
# Perform ANOVA for Obsessions
obsessions_anova <- aov(Score_Value ~ Education.Level, data = data_long[data_long$Score_Type == "Y.BOCS.Score..Obsessions.", ])

# Perform ANOVA for Compulsions
compulsions_anova <- aov(Score_Value ~ Education.Level, data = data_long[data_long$Score_Type == "Y.BOCS.Score..Compulsions.", ])

# Summarize ANOVA results
summary(obsessions_anova)
summary(compulsions_anova)

TukeyHSD(obsessions_anova)
TukeyHSD(compulsions_anova)

# Obsession
# The p-value associated with the F value is 0.348, which is above the conventional significance level of 0.05. This indicates that there is insufficient evidence to reject the null hypothesis, suggesting that there are no statistically significant differences in Y.BOCS.Score across education levels within Obsessions. No significant differences are observed in Tukey test.

# Compulsion
# The p-value associated with the F value is 0.169, which is above the conventional significance level of 0.05. This indicates that there is insufficient evidence to reject the null hypothesis, suggesting that there are no statistically significant differences in Y.BOCS.Score across education levels within Compulsions. No significant differences are observed in Tukey test.

# In both cases, since the p-values are greater than 0.05, fail to reject the null hypothesis. This suggests that there are no statistically significant differences in Y.BOCS.Score across education levels within Obsessions or Compulsions.
```

in-text for obsessions_anova: $F$() = `r round(summary(obsessions_anova)[[1]]$F[1],3)`
$p$() = `r round(summary(obsessions_anova)[[1]]$P[1],3)`



```{r correlation-between-obsession-and-compulsion-scores, fig.cap="Correlation between obsessions Y-BOCS-Score and compulsions Y-BOCS-Score"}
data %>% 
  ggplot(aes(x = Y.BOCS.Score..Obsessions., y = Y.BOCS.Score..Compulsions.)) +
  geom_jitter() +
  geom_smooth(method = 'gam') +
  labs(
    x = "Y-BOCS Score for Obsessions",
    y = "Y-BOCS Score for Compulsions",
    title = "Correlation Between Y-BOCS Score for Obsessions and for Compulsions"
  ) +
  theme_apa()
```



# Reference both figures and table
As shown in the figure (Figure\\@ref(fig:family-history-plot)), and figure (Figure\\@ref(fig:score-plot)) and table (Table\\@ref(tab:frequency-table)).


# **Introduction**



<!-- Ordered list -->
I will analyze these three research questions below.  
1. Is there a significant difference in the prevalence of OCD among individuals with varying levels of education?  
2. Does the family history of OCD contribute to the development of the OCD disorder?  
3. Are patients previously diagnosed with other disorders more likely to develop OCD?

<!-- Unordered list -->
I will analyze from three aspects.  
* Association of education level with prevalence of OCD.  
* Association of family history of OCD with prevalence of OCD.  
* Association of previously diagnosed disorders with prevalence of OCD.  

<!-- Linked URL -->
[My GitHub](https://github.com/luchen0805/OCD)

# **Methods**

# **Data analysis**
I used `r cite_r("r-references.bib")` for all our analyses.

## ***Association of education level with prevalence of OCD***

### Is there a significant difference

## ***Association of family history of OCD with prevalence of OCD***

## ***Impact of previously diagonsed disorders on prevalence of OCD***

# **Results**

# **Discussion**


\newpage

# **References**

::: {#refs custom-style="Bibliography"}
:::
