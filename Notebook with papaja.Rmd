---
title             : "Prevalence of OCD in different patient groups"
short title       : "OCD patients information analysis"

author: 
  - name          : "Luchen Yu"
    affiliation   : "University of Chicago"
    email         : "ylc23@uchicago.edu"

  <!-- https://tinyurl.com/ybremelq -->
  
keywords          : "keywords"
wordcount         : "X"

bibliography      : "r-references.bib"

floatsintext      : no
linenumbers       : yes
draft             : no
mask              : no

figurelist        : no
tablelist         : no
footnotelist      : no

classoption       : "man"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
# load papaja package
library("papaja")
source("R code.R",local = knitr::knit_global())
r_refs("r-references.bib")
```

```{r helloworld, include = FALSE}
# call hello_world function
source("functions.R", local = knitr::knit_global())
```

```{r OCD data prep}
# load readr package
library(readr)

# read in the dataset
data <- read.csv("ocd_patient_dataset.csv")

# examine the dataset
str(data)

# It includes many variable columns that I don't need, and I don't want Patient.ID to represent patients, I want ordered patient numbers

# select specific variable columns that are related to my research questions
library(dplyr)
data <- select(data, Patient.ID, Education.Level, Family.History.of.OCD, Previous.Diagnoses, Y.BOCS.Score..Obsessions., Y.BOCS.Score..Compulsions.)
data

# Now I have only these three variable columns that I need for the project with patient ID column
# For a more clear looking dataset, I want to replace these non-ordered patient ID with integers 1-1500
# I will remove Patient.ID column and create Patient.Number column as the first variable column

# create a new patient id column with ordered integers from 1 to 1500
new_patients_id <- 1:1500
data$Patient.ID <- new_patients_id
data

# export this new dataset
csv_file_path <- "final_data_prep.csv"
write.csv(data, csv_file_path)

# Now it's a concise dataset with every variable I need and ordered with patient numbers
# And I think it's good now for the next data analysis part

# each column is either a character or numeric number
# each row is a single observation for one patient
# each cell is a single measurement
# for research questions about the association of the prevalence of OCD with education level, family history of OCD, and previously diagnosed disorders, only the column "Education Level", "Family History of OCD", and "Previous Diagnoses" are needed, all the other columns are extraneous
```

```{r intermediate OCDdata}
# create an intermediate dataset
# select specific columns that are related to my research questions
library(dplyr)
select(OCD.data, Education.Level, Family.History.of.OCD, Previous.Diagnoses)

# keep rows based on certain column values
# High school as education level, has family history of OCD, and does not be previously diagnosed
filter(OCD.data, Education.Level == "High School" & Family.History.of.OCD == "Yes" & Previous.Diagnoses == "None")

# combine the two
# intermediate dataset for High school educated patients with family history of OCD and does not be diagnosed with other disorders before
intermediate.OCD.data <- OCD.data %>%
  select(Education.Level, Family.History.of.OCD, Previous.Diagnoses) %>%
  filter(Education.Level == "High School" & Family.History.of.OCD == "Yes" & Previous.Diagnoses == "None")

# write into csv filetype
csv_file_path <- "intermediate_ocd_data.csv"
write.csv(intermediate.OCD.data, csv_file_path)
```

```{r plot for how family history of OCD correlates with the frequency of OCD diagnoses across education levels}
# To see how the presence or absence of a family history of OCD correlates with the frequency of OCD diagnoses across education levels, I plan to create a bar graph. The x-axis stands for the education levels. The y-axis represents the frequency or count of individuals diagnosed with OCD at each education level. The filling represents whether individuals have a family history of OCD.

ggplot(data, aes(x = Education.Level, fill = Family.History.of.OCD)) +
  geom_bar(position = "dodge", color = "black") +
  scale_fill_manual(values = c("Yes" = "purple", "No" = "pink")) + 
  labs(
    x = "Education Level",
    y = "Frequency",
    fill = "Family History of OCD",
    title = "Frequency of OCD by Education Level"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# according to the plot, within the group of individuals without a family history of OCD, the graduate degree column has the lowest height, and the some college column has the highest height, following by high school and college degree column. So, it can be concluded that the lower the education level, the more individuals have diagnosed with OCD. But statistical analysis is needed: binomial test using yes/no (yes=1, no=0), or chi-square test.

# the plot looks fine, no more editing is needed
```

```{r plot for two types of Y-BOCS Score across different education levels}
# reshape data into long format, gather the variables "Y-BOCS Score Obsessions" and "Y-BOCS Score Compulsions" into one single column named "Score_Value", and a new column named "Score_Type" is created to indicate the type of score.

# convert data into long format
data_long <- data %>%
  pivot_longer(cols = c(Y.BOCS.Score..Obsessions., Y.BOCS.Score..Compulsions.), names_to = "Score_Type", values_to = "Score_Value")

# Create boxplots
data_long %>%
  ggplot(aes(x = Education.Level, y = Score_Value, fill = Education.Level)) +
  geom_boxplot() +
  # geom_point(position = position_jitter(width = 0.2), size = 2)
  facet_wrap(~ Score_Type, scales = "free_y") +
  labs(x = "Education Level", y = "Y-BOCS Score", title = "Boxplot of Y-BOCS Scores by Education Level") +
  theme_minimal()

# for this plot, maybe it's not clear to compare two scores for each education level, so I put the boxplots for two types of scores next to each other for each education level in the next plot
```

```{r another way to plot for two types of Y-BOCS Score across different education levels}
# this plot makes it easier to compare two different types of scores for each education level, e.g. to compare the mean, Q1, Q3 for each boxplot for two types of scores for one education level
# Convert data into long format
data_long <- data %>%
  pivot_longer(cols = c(Y.BOCS.Score..Obsessions., Y.BOCS.Score..Compulsions.), names_to = "Score_Type", values_to = "Score_Value")

# Create boxplots with labels
data_long %>%
  ggplot(aes(x = Education.Level, y = Score_Value, fill = Score_Type, group = interaction(Education.Level, Score_Type))) +
  geom_boxplot(position = position_dodge(width = 0.8), width = 0.6, alpha = 0.7) +
  labs(x = "Education Level", y = "Y-BOCS Score", title = "Boxplot of Y-BOCS Scores by Education Level") +
  theme_minimal()

# Summary Statistics
summary_stats <- data_long %>%
  group_by(Education.Level, Score_Type) %>%
  summarise(
    mean = mean(Score_Value),
    median = median(Score_Value),
    sd = sd(Score_Value),
    Q1 = quantile(Score_Value, 0.25),
    Q3 = quantile(Score_Value, 0.75),
    .groups = "drop"
  )
summary_stats
```

```{r plot to visualize the distribution of two types of scores within each education level group based on the previous boxplot}
# Convert data into long format
data_long <- data %>%
  pivot_longer(cols = c(Y.BOCS.Score..Obsessions., Y.BOCS.Score..Compulsions.), names_to = "Score_Type", values_to = "Score_Value")

# Create density plots
ggplot(data_long, aes(x = Score_Value, fill = Score_Type)) +
  geom_density(alpha = 0.5) +
  facet_wrap(~ Education.Level, nrow = 2) +
  labs(x = "Y-BOCS Score", y = "Density", fill = "Score Type", title = "Density Plot of Y-BOCS Scores by Education Level") +
  theme_minimal()
```


```{r relation between two types of scores across different education levels}
# create a scatterplot
ggplot(data, aes(x = Y.BOCS.Score..Obsessions., y = Y.BOCS.Score..Compulsions., color = Education.Level)) +
  geom_point() +
  labs(x = "Y-BOCS Score (Obsessions)", y = "Y-BOCS Score (Compulsions)", title = "Scatterplot of Y-BOCS Scores by Education Level") +
  theme_minimal()

# this plot is really a mass, it can be seen there's no relationship between two scores because points are randomly distributed for each education level between two types of scores
```


```{r plot for previous diagnoses count over different educational levels}
# To see how different previously diagnosed diseases associate with frequency of OCD across education levels, I plan to create a bar graph. The x-axis stands for the education levels. The y-axis represents the frequency or count of individuals diagnosed with OCD at each education level. The filling represents different previously diagnosed disorders other than OCD.

diagnoses_count <- table(data$Previous.Diagnoses)
ggplot(data, aes(x = Education.Level, fill = Previous.Diagnoses)) +
  geom_bar() +
  labs(
    x = "Education Level",
    y = "Frequency of OCD",
    fill = "Previous Diagnoses",
    title = "Frequency of OCD by Education Level and Previous Diagnoses"
  ) +
  theme_minimal()

# compare the count for each education level for each previously diagnosed disease. carry out ANOVA test for each diagnosed disease.
```

# calculate frequency of each education level
education_table <- table(data$Education.Level)
education_table

# calculate proportion of each education level
proportion_education_level <- prop.table(education_table)
proportion_education_level

# calculate frequency of with/without family history
family_history_table <- table(data$Family.History.of.OCD)
family_history_table

# calculate proportion
proportion_family_history <- prop.table(family_history_table)
proportion_family_history

```


```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```

# **Introduction**



<!-- Ordered list -->
I will analyze these three research questions below.  
1. Is there a significant difference in the prevalence of OCD among individuals with varying levels of education?  
2. Does the family history of OCD contribute to the development of the OCD disorder?  
3. Are patients previously diagnosed with other disorders more likely to develop OCD?

<!-- Unordered list -->
I will analyze from three aspects.  
* Association of education level with prevalence of OCD.  
* Association of family history of OCD with prevalence of OCD.  
* Association of previously diagnosed disorders with prevalence of OCD.  

<!-- Linked URL -->
[My GitHub](https://github.com/luchen0805/OCD)

# **Methods**

# **Data analysis**
We used `r cite_r("r-references.bib")` for all our analyses.

## ***Association of education level with prevalence of OCD***

### Is there a significant difference

## ***Association of family history of OCD with prevalence of OCD***

## ***Impact of previously diagonsed disorders on prevalence of OCD***

# **Results**

# **Discussion**


\newpage

# **References**

::: {#refs custom-style="Bibliography"}
:::
